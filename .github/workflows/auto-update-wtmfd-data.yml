name: Auto-update wtmfd_data.json from Datamine (main branch)

on:
  schedule:
    - cron: '0 0 * * *'  # Ежедневно в 00:00 UTC
  workflow_dispatch:     # Возможность запуска вручную

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout war_thunder_plane_data repo
        uses: actions/checkout@v4
        with:
          path: script-repo

      - name: Checkout War-Thunder-Datamine
        uses: actions/checkout@v4
        with:
          repository: gszabi99/War-Thunder-Datamine
          ref: master         # ← Исправлено: не main, а master!
          path: War-Thunder-Datamine-master
          fetch-depth: 1
      - name: Checkout WT-MFD repo (main branch)
        uses: actions/checkout@v4
        with:
          repository: Sergey-Titkov/WT-MFD
          ref: main
          token: ${{ secrets.WTMFD_PAT }}
          path: WT-MFD

      - name: Set up Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install packaging
          pip install war_thunder_plane_info
          